# 输入一个url访问一个页面过程

## DNS解析

### DNS协议用来将URL解析为IP地址，是基于UDP的协议

1. 查找本地缓存，如果没有则进行下一步
2. 向设置的DNS服务器查询，如果没有则进行下一步
3. 向根DNS服务器查询

## 判断是否为一个子网

DNS解析到的IP与子网掩码进行按位相与，得到网络号，判断是否是一个子网

## TCP握手建立连接

## TSL握手

### 非对称加密

### 对称加密

### CA证书

CA证书由CA机构颁布，里面包含了服务端的公钥，和用于加密的hash算法

CA证书通过数字签名的方式保证证书不被篡改L
数字签名即，CA机构根据证书内容形成摘要，通过自己的私钥进行签名，服务端向客户端发送证书后，客户端利用CA公钥对`数字签名`进行解密得到`摘要信息1`，再根据证书的hash算法得到`摘要信息2`,对比摘要信息是否相同

## 应用层数据包装

数据格式化

## 传输层

增加TCP标头，包含发送方和接收方的端口号

## 网络层

增加IP标头，包含发送方和接收方的IP地址

## 数据链路层

### 如果是一个子网

进行ARP协议(ip为接收方)，得到发送方的的MAC地址，增加MAC标头

### 如果不是一个子网

进行ARP协议(ip为网关)，得到网关的MAC地址，增加MAC标头

## 物理层

传输

### 网关

根据路由协议将包转发

### 接收方

从下层到上层依次拆包，得到http请求内容，根据请求内容，做出响应

## 发送方得到响应

根据格式进行HTML解析

## HTML解析

HTML字符串通过状态机，转换为token，再利用栈转化为dom

在这过程中

## 遇到css

并行下载css，并进行将css转化为CSSOM,这个过程阻塞后续js执行，不阻塞dom形成，阻塞渲染

## 遇到JS

判断js文件类型

### 普通js

并行下载，阻塞dom形成，下载完成依次执行js

### async

并行下载，不阻塞dom形成，下载完成立即执行js，无序

### defer

并行下载，不阻塞dom形成，dom解析完后执行js，有序

## 最终

初始的HTML被完全加载和解析后会触发，DOMContentLoaded事件

DOM 和 CSSOM 形成renderTree

之后根据renderTree 计算元素位置等信息，绘制图层，并合并图层

## 最后经过一段时间，tcp中没有信息传输，则进行四次挥手断开连接